!function(e){var t={};function o(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t){!function(){let e=!1;const t=[],o=["jj-img","img"];window.SlardarWeb("on","start",()=>{for(e=!0;t.length;){t.shift()()}});const r=(o,r)=>{const{metric:n,categories:s}=r||{metric:void 0,categories:void 0};e?window.SlardarWeb("sendEvent",{name:o,metric:n,categories:s}):t.push(()=>{window.SlardarWeb("sendEvent",{name:o,metric:n,categories:s})})},n=/headless/i.test(navigator.userAgent),s=!PluginArray.prototype===navigator.plugins.__proto__,i=!navigator.languages,a=!!navigator.webdriver,c=!window.outerHeight&&!window.outerWidth,u=n||s||i||a||c;if(window.isHeadless=u,r("headless_detect",{categories:{isHeadless:u,isHeadlessUA:n,isHeadlessPlugins:s,isHeadlessLanguages:i,isHeadlessWebdriver:a,isHeadlessOuter:c}}),u)return;if("function"!=typeof Promise||"function"!=typeof Promise.any||"function"!=typeof Proxy||"function"!=typeof Set||"function"!=typeof AbortController||"function"!=typeof URL||"object"!=typeof Reflect||"function"!=typeof String.prototype.startsWith)return;const l=/(jj|passport|juejin|cdn-tos)\.(byteimg|bytescm)/i,f=/(cdn-tos)\.bytescm/i,m=/^(https|http):\/\//i,d=/^\/\//i,p="-1",g="0",b="1",y=new Set,h=new Set,j=new Proxy({jj:{usableDomain:"",hasRunPing:!1,backups:["p1-jj.byteimg.com","p2-jj.byteimg.com","p6-jj.byteimg.com","p9-jj.byteimg.com"],errorQueue:[],source:"/tos-cn-i-t2oaga2asx/gold-user-assets/2018/7/16/164a1386a8b82dbd~tplv-t2oaga2asx-no-mark:50:50:50:50.jpg"},juejin:{usableDomain:"",hasRunPing:!1,backups:["p1-juejin.byteimg.com","p3-juejin.byteimg.com","p6-juejin.byteimg.com","p9-juejin.byteimg.com"],source:"/tos-cn-i-k3u1fbpfcp/7b420fc725a54dc4a3111dc4a3866961~tplv-k3u1fbpfcp-no-mark:240:240:240:160.jpg",errorQueue:[]},passport:{usableDomain:"",hasRunPing:!1,backups:["p3-passport.byteimg.com","p6-passport.byteimg.com"],source:"/img/user-avatar/ec67e169b62e429d9ea7a782a92d69d6~100x100.jpg",errorQueue:[]},"cdn-tos":{usableDomain:"",hasRunPing:!1,backups:["lf-cdn-tos.bytescm.com","lf1-cdn-tos.bytescm.com","lf3-cdn-tos.bytescm.com","lf6-cdn-tos.bytescm.com"],source:"obj/static/xitu_juejin_web/static/favicon.ico",errorQueue:[]}},{get(e,t){const o=Reflect.get(e,t);return"object"==typeof o?new Proxy(o,this):o},set(e,t,o){if("usableDomain"===t&&o){const{errorQueue:t}=e;for(;t.length;){const e=t.shift();v(e,o)}}return Reflect.set(e,t,o)}}),w=e=>{if(e&&!e.startsWith("data:image")&&!e.startsWith("blob:"))try{return new URL(P(e))}catch(t){console.log(t,e)}},v=(e,t)=>{const o=e.getAttribute("src")?"src":"href",n=e.getAttribute(o),s=_(n,t);y.has(s)||(h.add(s),e.setAttribute(o,s),r("cdn_assets_fix",{categories:{url:s,status:p,originalUrl:n}}))},P=e=>(d.test(e)?e="https:"+e:m.test(e)||(e="https://"+e),e),_=(e,t)=>{const o=w(e);if(o){const e=P(t),r=new URL(e);return o.host=r.host,o.port=r.port,o.protocol=r.protocol,o.href}},x=async(e,t)=>{const{backups:r,source:n}=j[e];try{const s=await Promise.any(r.map(e=>{const r=P(e+n);return o.includes(t)?((e="",t=3e3)=>new Promise((o,r)=>{if(!e)return void r("loadImage error: src is empty");const n=w(e);if(!n)return;const s=n.hostname,i=new Image,a=setTimeout(()=>{r(!1)},t);i.onload=()=>{clearTimeout(a),o(s)},i.onerror=()=>{clearTimeout(a),r(!1)},i.src=e}))(r):((e,t=3e3)=>new Promise((o,r)=>{if(!e)return void r("loadSource error: src is empty");const n=w(e);if(!n)return;const s=n.hostname,i=new AbortController,a=setTimeout(()=>i.abort(),t);return fetch(e,{signal:i.signal}).then(e=>{e.ok?o(s):r(!1)}).catch(()=>{r(!1)}).finally(()=>{clearTimeout(a)})}))(r)}));j[e].usableDomain=s}catch(e){console.log(e)}},S=(e,t,n)=>{const{target:s}=e;if(s.tagName.toLowerCase()===t){const e=s.getAttribute(n),i=w(e);if(!i)return;const{hostname:a,href:c}=i;h.has(c)&&r("cdn_assets_fix",{categories:{url:c,status:b}});const u=a.match(o.includes(t)?l:f);if(u){const e=u[1];j[e].usableDomain||(j[e].usableDomain=a)}}},k=(e,t,n)=>{const{target:s}=e;if(s.tagName.toLowerCase()===t){const e=s.getAttribute(n);y.add(e);const i=w(e);if(!i)return;const{hostname:a,href:c}=i;h.has(c)&&r("cdn_assets_fix",{categories:{url:c,status:g}});const u=a.match(o.includes(t)?l:f);if(u){const e=u[1],o=j[e];o.usableDomain?v(s,o.usableDomain):(o.errorQueue.push(s),o.hasRunPing||(x(e,t),o.hasRunPing=!0))}}};document.addEventListener("load",e=>{o.forEach(t=>{S(e,t,"src")}),S(e,"link","href")},!0),document.addEventListener("error",e=>{o.forEach(t=>{k(e,t,"src")}),k(e,"link","href")},!0)}()}]);