var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(A,t,e)=>t in A?__defProp(A,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):A[t]=e,__spreadValues=(A,t)=>{for(var e in t||(t={}))__hasOwnProp.call(t,e)&&__defNormalProp(A,e,t[e]);if(__getOwnPropSymbols)for(var e of __getOwnPropSymbols(t))__propIsEnum.call(t,e)&&__defNormalProp(A,e,t[e]);return A},__spreadProps=(A,t)=>__defProps(A,__getOwnPropDescs(t)),__publicField=(A,t,e)=>(__defNormalProp(A,"symbol"!=typeof t?t+"":t,e),e);!function(A,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((A="undefined"!=typeof globalThis?globalThis:A||self).JJImage={})}(this,(function(A){var t,e,r;const i="undefined"!=typeof window&&window.devicePixelRatio?window.devicePixelRatio:2,a="jj_webp_is_support",s="jj_avif_static_is_support",o="jj_avif_animation_support";function n(A){return 10*Math.ceil(A/10)}const l={image:"image",webp:"awebp",jpg:"jpg",png:"png",gif:"gif",avif:"avis",heic:"heif",auto:void 0};function p(A){var t;return null!=(t=l[A])?t:"image"}function u(A="",t=2e4){return new Promise(((e,r)=>{if(!A)return void r(new Error("loadImage error: src is empty"));const i=new Image,a=setTimeout((()=>{e(!1)}),t);i.onload=()=>{clearTimeout(a),e(!0)},i.onerror=()=>{clearTimeout(a),e(!1)},i.src=A}))}const c=/^(tplv-([0-9a-zA-Z]*)-[0-9a-zA-Z-]*)((:[0-9a-zA-Z]*)*)\.([0-9a-zA-Z]*)$/;const m=(()=>{let A=null;return async()=>{if(!w())return!1;if(null!==A)return A;return u("data:image/webp;base64,UklGRi4AAABXRUJQVlA4TCEAAAAvAUAAEB8wAiMwAgSSNtse/cXjxyCCmrYNWPwmHRH9jwMA").then((t=>(A=t,f(a,t?"1":void 0),t)))}})(),g=(()=>{let A=null;return async()=>{if(!w())return!1;if(null!==A)return A;return u("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=").then((t=>(A=t,f(s,t?"1":void 0),t)))}})(),h=(()=>{let A=null;return async()=>{if(!w())return!1;if(null!==A)return A;return A=u("data:image/avif;base64,AAAALGZ0eXBhdmlzAAAAAGF2aWZhdmlzbXNmMWlzbzhtaWYxbWlhZk1BMUIAAAGNbWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAsaWxvYwAAAABEAAACAAEAAAABAAAHiQAAADMAAgAAAAEAAAbEAAAAHAAAAEJpaW5mAAAAAAACAAAAGmluZmUCAAAAAAEAAGF2MDFDb2xvcgAAAAAaaW5mZQIAAAAAAgAAYXYwMUFscGhhAAAAABppcmVmAAAAAAAAAA5hdXhsAAIAAQABAAAAw2lwcnAAAACdaXBjbwAAABRpc3BlAAAAAAAAAAQAAAAEAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIAAoAAAAAOcGl4aQAAAAABCAAAAAxhdjFDgQAcAAAAADhhdXhDAAAAAHVybjptcGVnOm1wZWdCOmNpY3A6c3lzdGVtczphdXhpbGlhcnk6YWxwaGEAAAAAHmlwbWEAAAAAAAAAAgABBAECgwQAAgQBBYYHAAAFA21vb3YAAAB4bXZoZAEAAAAAAAAA4PFSHAAAAADg8VIcAAAD6AAAAAAAAAH0AAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAJBdHJhawAAAGh0a2hkAQAAAQAAAADg8VIcAAAAAODxUhwAAAABAAAAAAAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAEAAAABAAAAAAB0W1kaWEAAAAsbWRoZAEAAAAAAAAA4PFSHAAAAADg8VIcAAAD6AAAAAAAAAH0VcQAAAAAAChoZGxyAAAAAAAAAABwaWN0AAAAAAAAAAAAAAAAbGliYXZpZgAAAAF1bWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAABNXN0YmwAAAAUc3RjbwAAAAAAAAABAAAHiQAAABxzdHNjAAAAAAAAAAEAAAABAAAACgAAAAEAAAA8c3RzegAAAAAAAAAAAAAACgAAADMAAAAcAAAAGgAAABkAAAAgAAAAHAAAACAAAAAaAAAAHgAAABsAAAAUc3RzcwAAAAAAAAABAAAAAQAAABhzdHRzAAAAAAAAAAEAAAAKAAAAMgAAAJVzdHNkAAAAAAAAAAEAAACFYXYwMQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAEAAQASAAAAEgAAAAAAAAAAQpBT00gQ29kaW5nAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIAAoAAAAAQY2NzdAAAAAB8AAAAAAACQnRyYWsAAABodGtoZAEAAAEAAAAA4PFSHAAAAADg8VIcAAAAAgAAAAAAAAAAAAAB9AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAABAAAAAQAAAAAABR0cmVmAAAADGF1eGwAAAABAAABvm1kaWEAAAAsbWRoZAEAAAAAAAAA4PFSHAAAAADg8VIcAAAD6AAAAAAAAAH0VcQAAAAAAChoZGxyAAAAAAAAAABwaWN0AAAAAAAAAAAAAAAAbGliYXZpZgAAAAFibWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAABInN0YmwAAAAUc3RjbwAAAAAAAAABAAAGxAAAABxzdHNjAAAAAAAAAAEAAAABAAAACgAAAAEAAAA8c3RzegAAAAAAAAAAAAAACgAAABwAAAATAAAAEwAAABMAAAATAAAAEwAAABMAAAATAAAAEgAAABIAAAAUc3RzcwAAAAAAAAABAAAAAQAAABhzdHRzAAAAAAAAAAEAAAAKAAAAMgAAAIJzdHNkAAAAAAAAAAEAAAByYXYwMQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAEAAQASAAAAEgAAAAAAAAAAQpBT00gQ29kaW5nAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAAAxhdjFDgQAcAAAAABBjY3N0AAAAAHwAAAAAAAH+bWRhdBIACgkAAAAAj5tTJUAyDRABQADDEgkAAOWvjbgSADIPMAcBAfvw9QAGGEglAJUVEgAyDzAIAgr78PUABhhIJQCRCBIAMg8wDAQT+/D1AAYYSCUAjOASADIPMBAIHPvw9QAGGEglAIlAEgAyDzAUECX78vUABhhIJACFgBIAMg8wGACo+/T1AAYYSCQAgcASADIPMBwBAfv29QAGGEgkAH6AEgAyDjAgAgr7+PUABhhIJAB7EgAyDjAkBBP7+vUABhhIJAB6EgAKCQAAAACPm1MhCDIkEAFAADDDDEggkAErU3FZ0XezaNj6lAnRzo+I2ak2K2oC0mHAEgAyGDAHAQH78PUAAYYYYSCAUAAdE32mMYaAgBIAMhYwCAIK+/D1AAGGGGEggFAAH8esxzbAEgAyFTAMBBP78PUAAYYYYSCAUAAhcEt+0BIAMhwwEAgc+/D1AAGGGGEggFAAI/ucu8w0edQOHvyAEgAyGDAUECX78vUAAYYYYSCAQAAl0WDfM3fHIBIAMhwwGACo+/SNQABhhhhIIBAADFFaOe5ZjWZyXN4EEgAyFjAcAQH79vUAAYYYYSCAQAAqFlKYSUASADIaMCACCvv49QABhhhhIIBAACtOLUPD7KujAJASADIXMCQEE/v69QABhhhhIIBAAHNJ69eRFEA=").then((A=>(f(o,A?"1":void 0),A))),A}})();function f(A,t){if(!w())return!1;try{return void 0!==t?window.localStorage.setItem(A,t):window.localStorage.removeItem(A),!0}catch(e){return!1}}function d(A){if(A&&"object"==typeof A)for(const t in A){const e=A[t];e&&"object"==typeof e&&!Object.isFrozen(e)&&d(e)}return Object.freeze(A)}function b(A){return"number"!=typeof A||A<0?0:Math.round(A)}function w(){return"undefined"!=typeof window&&!!(null==window?void 0:window.localStorage)}const v=/p\d{1,2}-passport\.(?:byteacctimg|byteimg)\.com/,y=/p-boe\.byted\.org\/img\/user-avatar-boe\/([a-zA-Z0-9]*)~/,B={name:"avatar",test({sourceInfo:A}){var t;return!!v.test((null==(t=A.urlParse)?void 0:t.hostname)||"")||!!y.test(A.originalUrl)},transform({sourceInfo:A,env:t,rule:e,output:r}){var i;if(!A.urlParse)return;const a="auto"===e.dpr?t.dpr:e.dpr,s=n(Math.round(e.resize.w)*a),o=n(Math.round(e.resize.h)*a);let l="image";"svg"===(null==(i=A.extra)?void 0:i.format)?l="image":"auto"===e.format||["avif","heic"].includes(e.format)?t.isSupportWebp?l="webp":A.extra&&(l=(A.extra.frames||1)>1?"gif":A.extra.hasAlpha?"png":"jpg"):["jpg","png","gif","webp","image"].includes(e.format)&&(l=e.format);const u=`${(A.urlParse.pathname||"").split("~")[0]}~${s}x${o}.${p(l)}`;r.url=`${A.urlParse.origin}${u}${A.urlParse.search}${A.urlParse.hash}`}},_=/p\d{1,2}-juejin\.byteimg\.com\/tos-cn-i-k3u1fbpfcp(\/(\w|-|%|\.)+)+~tplv-k3u1fbpfcp-([^.]+)\.(\w+)/,j={name:"k3u1fbpfcp",test:({sourceInfo:A})=>!!_.test(A.originalUrl),transform({sourceInfo:A,env:t,rule:e,output:r}){var i,a;if(!A.urlParse||!A.imagexParse)return;const s="auto"===e.dpr?t.dpr:e.dpr;let o="image";"svg"===(null==(i=A.extra)?void 0:i.format)?o="image":"auto"===e.format?t.isSupportAvif||t.isSupportAvifStatic&&A.extra&&1===(A.extra.frames||1)||t.isSupportAvifAnimation&&A.extra&&(A.extra.frames||1)>1?o="avif":t.isSupportWebp?o="webp":A.extra&&(o=(A.extra.frames||1)>1?"gif":A.extra.hasAlpha?"png":"jpg"):o=e.format;let n=75;e.quality&&"number"==typeof e.quality&&(n=e.quality<=0?75:e.quality>=100?100:b(e.quality));let l="";l="svg"===(null==(a=A.extra)?void 0:a.format)?"tplv-k3u1fbpfcp-image":e.watermark?["tplv-k3u1fbpfcp-jj-mark",b(e.resize.w*s),b(e.resize.h*s),b(e.crop.w*s),b(e.crop.h*s),`q${n}`].join(":"):["tplv-k3u1fbpfcp-jj",b(e.resize.w*s),b(e.resize.h*s),b(e.crop.w*s),b(e.crop.h*s),`q${n}`].join(":"),l+=`.${p(o)}`,r.url=`${A.urlParse.origin}${A.imagexParse.uri}~${l}${A.urlParse.search}${A.urlParse.hash}`}},E=/p[136]-live\.byteimg\.com\/tos-cn-i-gjr78lqtd0(\/(\w|-|%|\.)+)+~tplv-gjr78lqtd0-([^.]+)\.(\w+)/,x={name:"live",test:({sourceInfo:A})=>!!E.test(A.originalUrl),transform({sourceInfo:A,env:t,rule:e,output:r}){var i;if(!A.urlParse||!A.imagexParse)return;const a="auto"===e.dpr?t.dpr:e.dpr;let s="image";"svg"===(null==(i=A.extra)?void 0:i.format)?s="image":"auto"===e.format?t.isSupportAvif||t.isSupportAvifStatic&&A.extra&&1===(A.extra.frames||1)||t.isSupportAvifAnimation&&A.extra&&(A.extra.frames||1)>1?s="avif":t.isSupportWebp?s="webp":A.extra&&(s=(A.extra.frames||1)>1?"gif":A.extra.hasAlpha?"png":"jpg"):s=e.format;let o=75;e.quality&&"number"==typeof e.quality&&(o=e.quality<=0?75:e.quality>=100?100:b(e.quality));let l=["tplv-gjr78lqtd0-resize-v1",n(b(e.resize.w*a)),`q${o}`].join(":");l+=`.${p(s)}`,r.url=`${A.urlParse.origin}${A.imagexParse.uri}~${l}${A.urlParse.search}${A.urlParse.hash}`}},S={name:"to-https",test:()=>!0,transform(A){A.output.url.includes("http://")&&(A.output.url=A.output.url.replace("http://","https://"))}};new class{constructor(A){var t;__publicField(this,"enable","undefined"!=typeof window),__publicField(this,"catchEffectTime",864e5),__publicField(this,"storageKey",""),__publicField(this,"testSuit",[]),__publicField(this,"testResult",Object.create(null)),__publicField(this,"autoFixCaseList",[]),this.storageKey=null!=(t=A.storageKey)?t:"jj_cdn_domain_test",this.testSuit=A.testSuit}init(){if(!this.enable)return;this.autoFixCaseList=[],this.testResult=Object.create(null);const A=function(A,t){if(A)try{const e=JSON.parse(A);if(t&&!t(e))throw new Error("safeParseJson error: validate error");return e}catch(e){return}}(localStorage.getItem(this.storageKey));A&&(A.val.forEach((A=>{this.testResult[A.id]=A,this.autoFixCaseList.push(A.id)})),A.expire<Date.now()&&this.doTest())}async doTest(){if(!this.enable)return;const A=(await Promise.all(this.testSuit.map((A=>Promise.all(A.domains.map((t=>u(`https://${t}${A.path}`)))))))).map(((A,t)=>{const e={id:this.testSuit[t].id,block:[],normal:[]};return A.forEach(((A,r)=>{const i=this.testSuit[t].domains[r];A?e.normal.push(i):e.block.push(i)})),this.testResult[e.id]=e,e})).filter((A=>A.block.length>0&&A.normal.length>0));this.autoFixCaseList=A.map((A=>A.id)),f(this.storageKey,A.length?JSON.stringify({expire:Date.now()+this.catchEffectTime,val:A}):void 0)}doFix(A){if(!this.enable||0===this.autoFixCaseList.length)return A;let t=A;return this.autoFixCaseList.some((e=>{const r=this.testResult[e];if(!r)return!1;const i=r.block.find((t=>A.indexOf(t)>=0));return i&&(t=A.replace(i,r.normal[0])),!!i})),t}}({testSuit:[{id:"t2oaga2asx",path:"/tos-cn-i-t2oaga2asx/gold-user-assets/2018/7/16/164a1386a8b82dbd~tplv-t2oaga2asx-jj:10:10:10:10:q75.jpg",domains:["p1-jj.byteimg.com","p2-jj.byteimg.com","p6-jj.byteimg.com","p9-jj.byteimg.com"]},{id:"userAvatar",path:"/img/user-avatar/ec67e169b62e429d9ea7a782a92d69d6~10x10.jpg",domains:["p3-passport.byteimg.com","p6-passport.byteimg.com","p3-passport.byteacctimg.com","p9-passport.byteacctimg.com","p6-passport.byteacctimg.com","p26-passport.byteacctimg.com"]},{id:"k3u1fbpfcp",uri:"/tos-cn-i-k3u1fbpfcp/7b420fc725a54dc4a3111dc4a3866961",path:"/tos-cn-i-k3u1fbpfcp/7b420fc725a54dc4a3111dc4a3866961~tplv-k3u1fbpfcp-jj:10:10:10:10:q75.jpg",domains:["p1-juejin.byteimg.com","p3-juejin.byteimg.com","p6-juejin.byteimg.com","p9-juejin.byteimg.com"]}]});const I=/p\d{1,2}-jj\.byteimg\.com\/tos-cn-i-t2oaga2asx(\/(\w|-|%|\.)+)+~tplv-t2oaga2asx-([^.]+)\.(\w+)/,P={name:"t2oaga2asx",test:({sourceInfo:A})=>!!I.test(A.originalUrl),transform({sourceInfo:A,env:t,rule:e,output:r}){var i,a;if(!A.urlParse||!A.imagexParse)return;const s="auto"===e.dpr?t.dpr:e.dpr;let o="image";"svg"===(null==(i=A.extra)?void 0:i.format)?o="image":"auto"===e.format?t.isSupportAvif||t.isSupportAvifStatic&&A.extra&&1===(A.extra.frames||1)||t.isSupportAvifAnimation&&A.extra&&(A.extra.frames||1)>1?o="avif":t.isSupportWebp?o="webp":A.extra&&(o=(A.extra.frames||1)>1?"gif":A.extra.hasAlpha?"png":"jpg"):o=e.format;let n=75;e.quality&&"number"==typeof e.quality&&(n=e.quality<=0?75:e.quality>=100?100:b(e.quality));let l="";l="svg"===(null==(a=A.extra)?void 0:a.format)?"tplv-t2oaga2asx-image":e.watermark?["tplv-t2oaga2asx-jj-mark",b(e.resize.w*s),b(e.resize.h*s),b(e.crop.w*s),b(e.crop.h*s),`q${n}`].join(":"):["tplv-t2oaga2asx-jj",b(e.resize.w*s),b(e.resize.h*s),b(e.crop.w*s),b(e.crop.h*s),`q${n}`].join(":"),l+=`.${p(o)}`,r.url=`${A.urlParse.origin}${A.imagexParse.uri}~${l}${A.urlParse.search}${A.urlParse.hash}`}},C=Symbol("processQueue"),Q=Symbol("transformEnv"),D=Symbol("imgUrlParseResultCatch"),z=!!w()&&Boolean(window.localStorage.getItem(a)),G=!!w()&&Boolean(window.localStorage.getItem(s)),Y=!!w()&&Boolean(window.localStorage.getItem(o));class k{constructor(){__publicField(this,t,[]),__publicField(this,e,{isSupportWebp:z,isSupportAvif:G&&Y,isSupportAvifAnimation:Y,isSupportAvifStatic:G,dpr:i}),__publicField(this,r,Object.create(null)),w()&&(h().then((A=>{this[Q].isSupportAvifAnimation=A,this[Q].isSupportAvif=this[Q].isSupportAvifStatic&&this[Q].isSupportAvifAnimation})),g().then((A=>{this[Q].isSupportAvifStatic=A,this[Q].isSupportAvif=this[Q].isSupportAvifStatic&&this[Q].isSupportAvifAnimation})),m().then((A=>{this[Q].isSupportWebp=A})))}setTransformEnv(A){this[Q]=A}addProcess(A){this[C].push(A)}standardizeRule(A={}){var t,e,r,i,a,s,o,n,l,p,u;const c={dpr:"auto",watermark:!0,crop:{h:0,w:0},resize:{h:0,w:0},format:"auto",quality:75};return c.dpr=A.dpr?A.dpr:c.dpr,c.watermark=null!=(t=A.watermark)?t:c.watermark,c.crop.h=null!=(r=null==(e=A.crop)?void 0:e.h)?r:c.crop.h,c.crop.w=null!=(a=null==(i=A.crop)?void 0:i.w)?a:c.crop.w,c.resize.h=null!=(o=null==(s=A.resize)?void 0:s.h)?o:c.resize.h,c.resize.w=null!=(l=null==(n=A.resize)?void 0:n.w)?l:c.resize.w,c.format=null!=(p=A.format)?p:c.format,c.quality=b(null!=(u=A.quality)?u:c.quality),d(c)}parseImgUrl(A){const t=Object.create(null);if(t.originalUrl=A,!A)return t.isLocal=!1,t.isImagex=!1,d(t);const e=A.startsWith("data:")||A.startsWith("blob:");if(t.isLocal=e,e)return t.isImagex=!1,d(t);if(this[D][A])return this[D][A];const r=function(A){const t=w()?window.location.href:"https://juejin.cn";if(!("canParse"in URL)||URL.canParse(A,t))try{return new URL(A,t)}catch(e){return}}(A);if(t.urlParse=r,!r)return d(t);if(t.extra=function(A){if(!A)return;const{hash:t}=A;if(!t.startsWith("#?"))return;const e=new URLSearchParams(t.substring(2));if(!((A,t)=>{for(const e of t)if(!A.has(e))return!1;return!0})(e,["w","h","e"]))return;return{width:Number(e.get("w")),height:Number(e.get("h")),format:e.get("e"),frames:Number(e.get("f")||1),hasAlpha:"1"===e.get("a"),bgColor:e.get("b")?`#${e.get("b")}`:void 0}}(r),t.isImagex=function(A){return A.indexOf("~tplv-")>0}(A),t.isImagex){const A=function(A){if(!A)return;if(A.pathname.indexOf("~tplv-")<=0)return;const[t,e]=A.pathname.split("~"),r=e.match(c);if(!r)return;const i=r[3].split(":").filter((A=>Boolean(A))).join(":");return{isSign:A.hostname.indexOf("-sign")>=0,isPrivate:A.hostname.indexOf("-private")>=0,serviceId:r[2],domain:A.hostname||"",uri:t,template:r[1],templateParams:i,format:r[r.length-1]}}(r);t.imagexParse=A}return d(t)}get transformEnv(){return __spreadValues({},this[Q])}transform(A,t,e){if(!A||"string"!=typeof A)return A;const r=this.parseImgUrl(A);if(r.isLocal)return A;const i={env:this[Q],rule:this.standardizeRule(t),sourceInfo:r,output:{url:A}};try{for(const A of this[C])if(A.test(i))try{A.transform(i)}catch(a){throw a}return i.output.url}catch(a){return null==e||e(i,a),A}}}t=C,e=Q,r=D;const F=[{format:"heic",type:"heif"},{format:"avif",type:"avif"},{format:"webp",type:"webp"}],W="default",H={loading:"eager",placeholder:!1,alt:"",processList:[B,x,j,P,S],shouldProcessAppend:!0,placeholder_error_remove:!0},U=["resize_w","resize_h","crop_w","crop_h","quality","placeholder_w","placeholder_h","dpr"],R=["shouldProcessAppend","watermark","placeholder","placeholder_error_remove"],N=["processList","type",...U,...R],M=["src","loading","alt","width","height","title","hidden","draggable","onload","onerror","img_class","img_id","img_style","refresh",...N],O=(A,t)=>`data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='${A}' height='${t}'></svg>`,$=(A,t)=>{A&&t.forEach((([t,e])=>{switch(t){case"img_style":A.setAttribute("style",e);break;case"img_class":A.setAttribute("class",e);break;case"img_id":A.setAttribute("id",e);break;default:A.setAttribute(t,e)}}))},Z=A=>{A.classList.add("jj-img-ph"),A.style.objectFit="cover",A.loading="eager"},q=A=>{if(void 0!==A)return"function"==typeof A?A():A},L=A=>{var t,e;const{src:r="",resize_w:i,resize_h:a,crop_h:s,crop_w:o,quality:n,transformInstance:l,placeholder:p,placeholder_w:u,placeholder_h:c,watermark:m,dpr:g,formatList:h}=A,f={resize:{w:q(i),h:q(a)},crop:{w:q(o),h:q(s)},dpr:q(g),quality:q(n),watermark:m,format:"image"},d=r?(h||F).map((({format:A,type:t})=>{const e=document.createElement("source"),i=__spreadProps(__spreadValues({},f),{format:A});"avif"!==A||l.transformEnv.isSupportAvif||(i.format="webp");const a=l.transform(r,i);return e.srcset=a,e.type=`image/${t}`,e})):[],b=(A=>Object.entries(A).filter((([A,t])=>!["src","class","style","id",...N].includes(A)&&null!=t&&"function"!=typeof t&&"object"!=typeof t)))(A),w=document.createElement("img"),v=l.transform(r,__spreadValues({},f));let y;if($(w,b),w.src=v,w.classList.add("jj-img-content"),u&&c){y=document.createElement("img");const A=null!=(t=q(u))?t:0,r=null!=(e=q(c))?e:0;$(y,b);const i=O(A,r);y.src=i,Z(y)}else if(r&&p)if(y=document.createElement("img"),$(y,b),p===W){const{extra:A,imagexParse:t}=l.parseImgUrl(v);if(A){const{height:e,width:r}=A,{templateParams:i="0:0:0:0:q75"}=t||{},[a,,s,o]=i.split(":"),n=Number(s),l=Number(o),p=Number(a)||r,u=n||p>r?r:p,c=O(u,l||u*(1/(r/e)));y.src=c,Z(y)}else y=void 0}else"string"==typeof p&&(y.src=p);return{sourceList:d,img:w,placeholderImg:y}},V=(()=>{const A=document.createElement("template");return A.innerHTML="<picture></picture>",A})(),T={},X=(A,t)=>{class e extends HTMLElement{constructor(){super(),this.globalConfig=__spreadValues({},H),this.name=A,this.isInit=!1}static get observedAttributes(){return M}getInstance(){const A=`${this.getAttribute("type")||W}:${this.name}`,t=T[A];if(t)return t;{const t=(A=>{var t;const e=new k;if((null==window?void 0:window.localStorage)&&(null==(t=null==window?void 0:window.localStorage)?void 0:t.getItem)||e.setTransformEnv({isSupportAvif:!0,isSupportAvifAnimation:!0,isSupportAvifStatic:!0,isSupportWebp:!0,dpr:2}),A.length)for(const r of A)e.addProcess(r);return e})(this.globalConfig.processList||H.processList||[]);return T[A]=t,t}}updateConfig(){let A={};if(Array.isArray(t)){const e=this.getAttribute("type")||W;A=t.find((A=>A.type===e))}else A=t;this.globalConfig=__spreadValues(__spreadValues({},this.globalConfig),A),this.globalConfig.shouldProcessAppend&&(this.globalConfig.processList=[...H.processList||[],...(null==A?void 0:A.processList)||[]])}replaceChildren(...A){for(;this.lastChild;)this.removeChild(this.lastChild);A.forEach((A=>{this.appendChild(A)}))}connectedCallback(){this.updateConfig();const A=this.render();this.replaceChildren(A),this.isInit=!0}attributeChangedCallback(A,t){if(this.isInit&&A!==t){const A=this.render();this.replaceChildren(A)}}render(){const A=(A=>{const t={};return Array.from(A).forEach((A=>{const e=A.name,r=A.value;U.includes(e)?t[e]="function"==typeof r?r:r?Number(r):r:R.includes(e)?t[e]="true"===r||"false"!==r&&r:t[e]=r})),t})(this.attributes),t=__spreadValues(__spreadValues({},this.globalConfig),A),e=V.content.cloneNode(!0),r=e.querySelector("picture"),i=this.getInstance(),{sourceList:a,img:s,placeholderImg:o}=L(__spreadProps(__spreadValues({},t),{transformInstance:i})),n=s.style.position,l=s.style.visibility,p=s.style.left;return o&&(r.appendChild(o),s.style.position="absolute",s.style.visibility="hidden",s.style.left="0"),r.append(...a),r.appendChild(s),s.onload=()=>{this.dispatchEvent(new Event("load")),o&&(o.remove(),o.style.display="none",s.style.position=n,s.style.visibility=l,s.style.left=p)},s.onerror=()=>{this.dispatchEvent(new Event("error")),o&&t.placeholder_error_remove&&(o.remove(),o.style.display="none",s.style.position=n,s.style.visibility=l,s.style.left=p)},e}}return e};A.register=(A,t)=>{if(!window.customElements.get(A)){const e=X(A,t);window.customElements.define(A,e)}},Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})}));
